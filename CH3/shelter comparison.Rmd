---
title: "CH3-shelter comparison"
author: "Nargol Ghazian"
date: "15/10/2019"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}

#open packages 
library(ggplot2)
library(ggthemes)

#import dataset 
main.data <- read.csv("C:/Users/Nargol Ghazian/Desktop/Animal-Behaviour-and-Climate-project/CH3/shelter_logger_comparison.csv")

str(main.data)

#exclude missing values
data.final<-na.omit(main.data)
#check for missing values
head(is.na(data.final))

#get rid of the extra open character
data.final$shelter.open <- gsub(" ", "", data.final$shelter.open)
data.final$shelter.open <- as.factor(data.final$shelter.open)
str(data.final)
summary (data.final)
```


```{r}
#Data visualization 
#automatic data 
qplot (data=data.final, temp)#data seem right-skewed
qplot (data=data.final, Intensity)#data looks exponential, but we have to explore more

#let's see if temperature and light intensity are correlated 
qplot(data= data.final, temp, Intensity, geom = c ("point", "smooth")) + xlab("Temperature (°F)") + ylab ("Light Intensity (lum/ft²)")+ theme_classic()+ theme(axis.text=element_text(size=12))#there seems to be a positive correlation

ggplot (data.final, aes(as.factor(cover.type), temp))+ facet_grid(~timeblock) + geom_boxplot() + xlab("Cover Type (% light permeability)") + ylab ("Temperature (°F)")+ theme_classic()+ theme(axis.text=element_text(size=12))

ggplot(data.final, aes(as.factor(shape),temp, fill=shape))+geom_boxplot() + facet_grid(~timeblock)+ xlab("Structure")+ ylab ("Temperature (°F)")+ theme_classic()+ theme(axis.text=element_text(size=12))+ theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

ggplot(data.final, aes(as.factor(cover.type), Intensity))+ facet_grid(~timeblock) + geom_boxplot() + xlab("Cover Type (% light permeability)") + ylab ("Light Intensity (lum/ft²)")+ theme_classic()+ theme(axis.text=element_text(size=12))

ggplot(data.final, aes(as.factor(shape), Intensity, fill=shape))+geom_boxplot() + facet_grid(~timeblock)+ xlab("Structure")+ ylab ("Light Intensity (lum/ft²)")+ theme_classic()+ theme(axis.text=element_text(size=12))+theme(axis.title.x=element_blank(),axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
        
ggplot(data.final, aes(as.factor(shelter.open), temp, fill= as.character(cover.type))) + geom_boxplot() + xlab("Treatment") + ylab ("Temperature (°F)")+ theme_classic()+ theme(axis.text=element_text(size=12))+labs (fill= "Cover Type")

ggplot(data.final, aes(as.factor(shelter.open), Intensity, fill= as.character(cover.type))) + geom_boxplot() + xlab("Treatment") + ylab ("Light Intensity (lum/ft²)")+ theme_classic()+ theme(axis.text=element_text(size=12))+ labs (fill= "Cover Type")

```


```{r}
#EDA
#explore normality 
#can't do Shapiro-Wilk dataset too large 
library(ggpubr)

ggqqplot(data.final$temp)#data is positively(right) skewed, Gaussian  
hist(data.final$temp) 
ggqqplot(data.final$Intensity)#data looks exponential or poisson 
hist(data.final$Intensity)
#neither intensity nor temperature follow a normal distribution
```


```{r}
#Models
cor.test(data.final$temp, data.final$Intensity, method= "kendall")


ggscatter(data.final, x="temp", y="Intensity", add= "reg.line", conf.int = TRUE, cor.coef = TRUE, method="kendall", xlab = "Temperature (°F)", ylab = "Light Intensity (lum/ft²)")#temperature and light are positively correlated (p-value<0.05)

#explore temperature more 
#perform a two-way anova
res.aov2 <- aov(temp~cover.type*shape, data = data.final)
summary (res.aov2)
#no signficant difference between shapes when it comes to temperature, but there is a difference in type of cover when it comes to temperature (p=0.00137<0.01)

#run a non-parametric post-hoc to make sure above is true
kruskal.test(temp ~ cover.type, data = data.final)# p-value<0.05

pairwise.wilcox.test(data.final$temp, data.final$cover.type)
#there is a sig. difference between 50% and 15% (p=0.0013), and between 90% and 50% (p=0.0115)

res.aov3 <- aov(temp~cover.type*shape+timeblock, data = data.final)
summary (res.aov3)
#cover.type by shape is significant (p=0.0743<0.1)

#explore light intensity 
res.aov5 <- aov(Intensity~cover.type*shape+timeblock, data = data.final)
summary (res.aov5)
#the type of cover does not affect light intensity significanly, but just shape and shape and cover together do

lm1 <- glm(temp~shape*cover.type*+timeblock, data = data.final, family="gaussian")
summary (lm1)
library (emmeans)
anova(lm1, test = "Chisq")
emmeans(lm1, pairwise~shape|timeblock)

lm2 <- glm(Intensity~shape*cover.type+timeblock, data = data.final, family="quasipoisson")
summary(lm2) 
anova (lm2, test="Chisq")
emmeans(lm2, pairwise~shape|timeblock)
```

```{r}
#Summary 
```






```{r}